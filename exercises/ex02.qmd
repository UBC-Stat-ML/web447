---
title: "Exercise 2: Bayes estimator"
editor: 
  mode: source
---
  
{{< include ../_macros.qmd >}}

## Goals

- Build a probability model for a concrete example.
- Introduce the concept of Bayes estimators.
- Review sequential Bayes update.

## Setup

This exercise is centered around the following scenario:
  
{{< include ../blocks/_delta.qmd >}}


## Q.1: define a probabilistic model

1. What are the unknown quantities in this scenario? And what is the data?

In order to perform inference on the unknown quantities, we must specify how
they relate to the data; i.e., we need a *probabilistic model*.
Assume that every Delta 7925H rocket has the same probability $p$ of failing.
For simplicity, let us assume that $p$ is allowed to take values on an evenly space grid
$$
p \in \left\{\frac{k}{K}: k\in \{0,\dots,K\}\right\}
$$
for some fixed $K\in\nats$. Furthermore, we have access to a collection of
numbers $\rho_k\in[0,1]$ such that
$$
\forall k\in\{0,\dots,K\}:\ \pr\left(p=\frac{k}{K}\right) = \rho_k.
$$

Let $Z_i$ denote a binary variable indicating a failed launch. We assume that,
conditionally on $p$, these binary variables are independent of each other.

2. Write the joint distribution of this model (use the $\sim$ notation).


## Q.2: probability calculations

1. Give an expression for the prior predictive probability of failure for the 
next launch
$$
\pr(Z_4=1)
$$

2. Give an expression for the posterior probability
$$
\pr\left(p=\frac{k}{K}\middle| Z_1=Z_2=Z_3=0 \right)
$$

3. Write a function called `posterior_distribution` that takes a vector 
$\rho\in\reals^{K+1}$ and returns the posterior distribution derived in the previous step.

4. Plot the result of applying `posterior_distribution` to the prior
$$
\rho_k \propto \frac{k}{K}\left(1-\frac{k}{K}\right).
$$ {#eq-parabola-prior} 
Add $\rho$ to the plot and compare the two 
distributions.

5. Report the mean, median, and mode of $p$ under the posterior distribution 
of the previous step.


## Q.3: Bayes action

Let $a\in\{0,1\}$ be a binary variable denoting the decision of buying the
insurance ($a=1$) or not ($a=0$).

1. Define a loss function $(a,Z_4)\mapsto L(a,Z_4)$ that summarizes the cost of 
having taken decision $a\in\{0,1\}$ when $Z_4\in\{0,1\}$ occurs.
2. Derive an expression for the expected loss under the posterior predictive distribution
$$
\mathcal{L}(a) := \ex[L(a,Z_4)|Z_{1:3}=0].
$$

3. Give an expression for the posterior predictive probability of failure
$$
\pr\left(Z_4=1 \middle| Z_{1:3}=0 \right)
$$
4. Write a function `posterior_failure_prob` that takes a vector 
$\rho\in\reals^{K+1}$ and returns the posterior predictive probability of failure.
Your function should call `posterior_distribution`.

5. Write a function `expected_loss` that computes $\mathcal{L}(a)$ for any value
of $a$. Based on this, formulate a recommendation to the owner of the satellite. 

## Q.4: sequential updating

Let us suppose that we go back in time and are able to recreate the inferences
that a statistician would have made as the successive launches happened.

1. Derive an expression for $\pr(p|Z_1=0)$.
2. Use the previous expression as a prior distribution 
**TODO**